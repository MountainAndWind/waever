<p>
    <style type="text/css">
        .detailAddTd{
            height : 60px;
        }
        .wfcontainer{
            text-align:center;
            width:100%;
            margin:0 auto;
        }
        .wfpage{
            width:960;
            text-align:center;
            margin:0 auto;
        }
        .wfnocon{
            width:100%;
            padding:0 20px;
        }
        .wfid{
            float:left;
        }
        .wfno{
            float:right;
        }
        .wftitle{
            font-family:Verdana;
            font-size:16pt;
            font-weight:bold;
            text-align:center;
            padding:15px;
            width:100%;
        }
        .wfmain{

        }
        .wfmaintable{
            font-size:9pt;
            border-collapse:collapse;
            width:100%;
        }
        .wfdetail{
            width:100%;
        }
        .wfdetailbtncon{
            width:100%;
            text-align:right;
            padding-right:20px;
        }
        .wfdetailtable{
            font-size:9pt;
            border-collapse:collapse;
            width:100%;
        }
        .fieldrow{
            height:40px;
        }
        .fieldlabel{
            border: #CBCDCA solid 1px;
            background-color:#eeeeee;
            height:30px;
            text-align:center;
            padding:5px 10px;
        }
        .fieldvalue{
            border: #CBCDCA solid 1px;
            text-align:left;
            padding:5px 10px;
        }
        .fielddetail{
            width:100%;
            border: #CBCDCA solid 1px;
        }
        .detailtitle{
            background-color:#E0EEEE;
            text-align:center;
            border: #CBCDCA solid 1px;
            height:30px;
        }
        .hide {
            display: none;
            height: 0px;
        }	</style>
</p>
<p class="hide">
    1<input class="InputStyle" id="$field7012$" name="field7012" type="text" value="[可编辑]依次审批" /><input class="InputStyle" id="$field6042$" name="field6042" type="text" value="[只读]经办人部门" /><input class="InputStyle" id="$field6413$" name="field6413" type="text" value="[可编辑]申请人角色" /><input class="InputStyle" id="$field6447$" name="field6447" type="text" value="[可编辑]节点2审批角色" /><input class="InputStyle" id="$field6448$" name="field6448" type="text" value="[可编辑]节点2标志" /><input class="InputStyle" id="$field6449$" name="field6449" type="text" value="[可编辑]节点3标志" /><input class="InputStyle" id="$field6450$" name="field6450" type="text" value="[可编辑]节点4标志" /><input class="InputStyle" id="$field6451$" name="field6451" type="text" value="[可编辑]节点5标志" /><input class="InputStyle" id="$field6452$" name="field6452" type="text" value="[可编辑]节点6标志" /><input class="InputStyle" id="$field6453$" name="field6453" type="text" value="[可编辑]节点7标志" /><input class="InputStyle" id="$field6481$" name="field6481" type="text" value="[可编辑]成本中心编号" /><input class="InputStyle" id="$field6661$" name="field6661" type="text" value="[可编辑]成本中心上级部门" /><input class="InputStyle" id="$field6662$" name="field6662" type="text" value="[可编辑]成本中心审批人" /><input class="InputStyle" id="$field6692$" name="field6692" type="text" value="[可编辑]创建人角色" /><input class="InputStyle" id="$field7720$" name="field7720" type="text" value="[可编辑]依次审批-季总" /><input class="InputStyle" id="$field7802$" name="field7802" type="text" value="[可编辑]依次审批（王翟）" /><input class="InputStyle" id="$field7803$" name="field7803" type="text" value="[可编辑]依次审批（吉翟）" /><input class="InputStyle" id="$field7913$" name="field7913" type="text" value="[可编辑]依次审批-季舒" /><input class="InputStyle" id="$field8005$" name="field8005" type="text" value="[可编辑]依次审批-姚丁" />1</p>
<div class="wfcontainer">
    <div class="wfpage">
        <div class="wfnocon">
            <div class="wfid">
                &nbsp;</div>
            <div class="wfno">
                &nbsp;编号：<input class="InputStyle" id="$field6484$" name="field6484" type="text" value="[只读]编号" /></div>
        </div>
        <div class="wftitle">
            陆家嘴国际信托有限公司<br />
            付款申请表</div>
        <div>
            <table style="width: 100%; height: 100%">
                <tbody>
                <tr>
                    <td style="text-align: right; width: 60px">
                        日期</td>
                    <td style="text-align: center; width: 120px">
                        <input class="InputStyle" id="$field5961$" name="field5961" size="10" style="width: 81px; height: 21px" type="text" value="[只读]申请日期" /></td>
                    <td>
                        &nbsp;预算年度&nbsp;<input class="InputStyle" id="$field7000$" name="field7000" type="text" value="[可编辑]预算年度" />&nbsp;年</td>
                    <td style="text-align: right; width: 80px">
                        附件</td>
                    <td style="text-align: center; width: 80px">
                        <input class="InputStyle" id="$field5962$" name="field5962" size="5" style="width: 45px; height: 21px" type="text" value="[必填]附件张数" /></td>
                    <td style="text-align: left; width: 40px">
                        张</td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="wfmain">
            <table cellpadding="0" cellspacing="0" class="wfmaintable">
                <colgroup>
                    <col width="120" />
                    <col width="200" />
                    <col width="120" />
                    <col width="100" />
                    <col width="100" />
                    <col width="120" />
                    <col width="200" />
                </colgroup>
                <tbody>
                <tr class="fieldrow">
                    <td class="fieldlabel">
                        成本中心</td>
                    <td class="fieldvalue" colspan="3">
                        <input class="InputStyle" id="$field6414$" name="field6414" size="10" style="width: 83px; height: 21px" type="text" value="[必填]成本中心" /></td>
                    <td class="fieldlabel">
                        申请人</td>
                    <td class="fieldvalue" colspan="2">
                        <input class="InputStyle" id="$field5982$" name="field5982" type="text" value="[只读]经办人" /></td>
                </tr>
                <tr class="fieldrow">
                    <td class="fieldlabel">
                        收款单位</td>
                    <td class="fieldvalue" colspan="6">
                        <input class="InputStyle" id="$field5963$" name="field5963" type="text" value="[必填]收款单位" /></td>
                </tr>
                <tr class="fieldrow">
                    <td class="fieldlabel">
                        收款银行</td>
                    <td class="fieldvalue" colspan="3">
                        <input class="InputStyle" id="$field5964$" name="field5964" type="text" value="[必填]收款银行" /></td>
                    <td class="fieldlabel">
                        账号</td>
                    <td class="fieldvalue" colspan="2">
                        <div style="width: 100%">
                            <input class="InputStyle" id="$field5965$" name="field5965" size="2041" style="width: 245px; height: 21px" type="text" value="[必填]账号" /></div>
                    </td>
                </tr>
                <tr class="fieldrow">
                    <td class="fieldlabel">
                        项目大类</td>
                    <td class="fieldvalue">
                        <input class="InputStyle" id="$field6998$" name="field6998" type="text" value="[必填]项目大类" /></td>
                    <td class="fieldlabel">
                        支付种类</td>
                    <td class="fieldvalue" colspan="2">
                        &nbsp;<input class="InputStyle" id="$field6999$" name="field6999" type="text" value="[可编辑]是否IT类" /></td>
                    <td class="fieldlabel">
                        使用部门</td>
                    <td class="fieldvalue">
                        &nbsp;<input class="InputStyle" id="$field7002$" name="field7002" type="text" value="[可编辑]使用部门" /></td>
                </tr>
                <tr class="fieldrow">
                    <td class="fieldlabel" colspan="7">
                        报销类别为招待费时，请先发起<a href="http://172.16.1.239/workflow/request/AddRequest.jsp?workflowid=271&amp;isagent=0&amp;beagenter=0&amp;f_weaver_belongto_userid=" target="_blank"><font color="red">业务招待申请流程</font></a></td>
                </tr>
                <tr class="fieldrow">
                    <td class="fielddetail" colspan="7">
                        <div class="wfdetail" id="detail0">
                            <div class="wfdetailbtncon" id="div0button">
                                <button accesskey="A" class="addbtn" id="$addbutton0$" name="addbutton0" onclick="addRow0(0);" type="button"></button><button accesskey="E" class="delbtn" id="$delbutton0$" name="delbutton0" onclick="if(isdel()){deleteRow0(0);}" type="button"></button></div>
                            <table class="wfdetailtable ListStyle" id="oTable0" name="oTable0">
                                <colgroup>
                                    <col width="250" />
                                    <col width="150" />
                                    <col width="100" />
                                    <col />
                                    <col width="140" />
                                    <col width="140" />
                                </colgroup>
                                <tbody>
                                <tr>
                                    <!--明细标头 增加列时需增加一个td-->
                                    <td class="detailtitle">
                                        <input class="Label" id="$label6360$" name="label6360" type="text" value="项目" /></td>
                                    <td class="detailtitle">
                                        预算信息</td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label6362$" name="label6362" type="text" value="金额" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label6361$" name="label6361" type="text" value="描述" /></td>
                                    <td class="detailtitle">
                                        业务申请表</td>
                                    <td class="detailtitle cbzx hide">
                                        <input class="Label" id="$label6473$" name="label6473" type="text" value="成本中心" /></td>
                                </tr>
                                <tr>
                                    <!--明细数据 增加列时需增加一个td-->
                                    <td>
                                        <input class="InputStyle" id="$field6360$" name="field6360" type="text" value="[必填]项目" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field7001$" name="field7001" type="text" value="[只读]预算信息" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field6362$" name="field6362" type="text" value="[必填]金额" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field6361$" name="field6361" type="text" value="[必填]描述" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9014$" name="field9014" value="[可编辑]业务申请表" /></td>
                                    <td class="cbzx hide">
                                        <input class="InputStyle" id="$field6473$" name="field6473" type="text" value="[必填]成本中心" /></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
                <tr class="fieldrow">
                    <td class="fielddetail" colspan="7">
                        <div class="wfdetail" id="detail1">
                            <div class="wfdetailbtncon" id="div0button">
                                <button accesskey="A" class="addbtn" id="$addbutton0$" name="addbutton0" onclick="addRow1(1);" type="button"></button><button accesskey="E" class="delbtn" id="$delbutton0$" name="delbutton0" onclick="if(isdel()){deleteRow1(1);}" type="button"></button></div>
                            <table class="wfdetailtable ListStyle" id="oTable1" name="oTable1">
                                <colgroup>
                                    <col width="250" />
                                    <col width="150" />
                                    <col width="100" />
                                    <col />
                                    <col width="140" />
                                    <col width="140" />
                                </colgroup>
                                <tbody>
                                <tr>
                                    <!--明细标头 增加列时需增加一个td-->
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9082$" name="label9082" value="发票号码" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9084$" name="label9084" value="价税合计" /></td>
                                    <td class="detailtitle" style="display:none">
                                        <input class="Label" id="$label9085$" name="label9085" value="不含税金额" /></td>
                                    <td class="detailtitle" style="display:none">
                                        <input class="Label" id="$label9086$" name="label9086" value="税额" /></td>
                                    <td class="detailtitle" style="display:none">
                                        <input class="Label" id="$label9499$" name="label9499" value="手机号" /></td>
                                    <td class="detailtitle" style="display:none">
                                        <input class="Label" id="$label9088$" name="label9088" value="备注" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9089$" name="label9089" value="发票日期" /></td>
                                    <td class="detailtitle" style="display:none">
                                        <input class="Label" id="$label9090$" name="label9090" value="发票代码" /></td>
                                    <td class="detailtitle" style="display:none">
                                        <input class="Label" id="$label9091$" name="label9091" value="是否有章" /></td>
                                    <td class="detailtitle" style="display:none">
                                        <input class="Label" id="$label9092$" name="label9092" value="收款方名称" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9402$" name="label9402" value="发票附件" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9492$" name="label9492" value="发票类型" /></td>
                                    <td class="detailtitle" style="display:none">
                                        <input class="Label" id="$label9493$" name="label9493" value="发票时间段" /></td>
                                    <td class="detailtitle" style="display:none">
                                        <input class="Label" id="$label9094$" name="label9094" value="摘要名称" /></td>
                                    <td class="detailtitle" style="display:none">
                                        <input class="Label" id="$label9095$" name="label9095" value="纳税人识别号" /></td>
                                    <td class="detailtitle" style="display:none">
                                        <input class="Label" id="$label9096$" name="label9096" value="地区" /></td>
                                    <td class="detailtitle" style="display:none">
                                        <input class="Label" id="$label9113$" name="label9113" value="付款方名称" /></td>
                                    <td class="detailtitle" style="display:none">
                                        <input class="Label" id="$label9498$" name="label9498" value="境内外标志" /></td>
                                    <td class="detailtitle" style="display:none">
                                        <input class="Label" id="$label9500$" name="label9500" value="发票姓名" /></td>
                                    <td class="detailtitle" style="display:none">
                                        <input class="Label" id="$label9497$" name="label9497" value="出租车号" /></td>
                                </tr>
                                <tr>
                                    <!--明细数据 增加列时需增加一个td-->
                                    <td>
                                        <input class="InputStyle" id="$field9082$" name="field9082" value="[可编辑]发票号码" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9084$" name="field9084" value="[可编辑]价税合计" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9085$" name="field9085" value="[可编辑]不含税金额" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9086$" name="field9086" value="[可编辑]税额" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9499$" name="field9499" value="[可编辑]手机号" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9088$" name="field9088" value="[可编辑]备注" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9089$" name="field9089" value="[必填]发票日期" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9090$" name="field9090" value="[可编辑]发票代码" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9524$" name="field9524" value="[可编辑]是否有章" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9092$" name="field9092" value="[可编辑]收款方名称" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9402$" name="field9402" value="[可编辑]发票附件" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9492$" name="field9492" value="[只读]发票类型" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9493$" name="field9493" value="[可编辑]发票时间段" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9094$" name="field9094" value="[可编辑]摘要名称" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9095$" name="field9095" value="[可编辑]纳税人识别号" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9096$" name="field9096" value="[可编辑]地区" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9113$" name="field9113" value="[可编辑]付款方名称" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9525$" name="field9525" value="[可编辑]境内外标志" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9500$" name="field9500" value="[可编辑]发票姓名" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9497$" name="field9497" value="[可编辑]出租车号" /></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
                <tr class="fieldrow">
                    <td class="fieldlabel">
                        应支付总额</td>
                    <td class="fieldvalue">
                        <input class="InputStyle" id="$field6331$" name="field6331" size="12" style="width: 93px; height: 21px" type="text" value="[可编辑]应支付总额小写" /></td>
                    <td class="fieldlabel">
                        已支付金额</td>
                    <td class="fieldvalue" colspan="2">
                        <input class="InputStyle" id="$field6332$" name="field6332" size="6" style="width: 50px; height: 21px" type="text" value="[可编辑]已支付总额小写" /></td>
                    <td class="fieldlabel">
                        申请支付金额</td>
                    <td class="fieldvalue">
                        <input class="InputStyle" id="$field6333$" name="field6333" type="text" value="[只读]申请支付总额" /></td>
                </tr>
                <tr class="fieldrow">
                    <td class="fieldlabel">
                        付款日期</td>
                    <td class="fieldvalue" colspan="4">
                        <input class="InputStyle" id="$field5970$" name="field5970" type="text" value="[必填]付款日期" /></td>
                    <td class="fieldlabel">
                        付款方式</td>
                    <td class="fieldvalue">
                        <input class="InputStyle" id="$field6359$" name="field6359" size="14" style="width: 112px; height: 21px" type="text" value="[必填]付款方式" /></td>
                </tr>
                <tr class="fieldrow">
                    <td class="fieldlabel">
                        事前申请流程</td>
                    <td class="fieldvalue" colspan="4">
                        <input class="InputStyle" id="$field5979$" name="field5979" type="text" value="[可编辑]相关请求" /></td>
                    <td class="fieldlabel">
                        事前申请金额</td>
                    <td class="fieldvalue">
                        <input class="InputStyle" id="$field5980$" name="field5980" size="11" style="width: 90px; height: 21px" type="text" value="[可编辑]审批金额" /></td>
                </tr>
                <tr class="fieldrow">
                    <td class="fieldlabel">
                        相关附件</td>
                    <td class="fieldvalue" colspan="6">
                        <input class="InputStyle" id="$field6358$" name="field6358" type="text" value="[可编辑]相关附件" /></td>
                </tr>
                <tr class="fieldrow" style="height: 80px">
                    <td class="fieldlabel">
                        付款事由</td>
                    <td class="fieldvalue" colspan="6">
                        <input class="InputStyle" id="$field5969$" name="field5969" type="text" value="[必填]付款事由" /></td>
                </tr>
                <tr class="fieldrow" style="height: 80px">
                    <td class="fieldlabel">
                        额外说明</td>
                    <td class="fieldvalue" colspan="6">
                        <input class="InputStyle" id="$field6656$" name="field6656" type="text" value="[可编辑]额外说明" /></td>
                </tr>
                <tr style="height: 0px">
                    <td>
                        <input class="Label" id="$label9518$" name="label9518" value="发票汇总金额" /><input class="InputStyle" id="$field9518$" name="field9518" value="[可编辑]发票汇总金额" /></td>
                    <td>
                        &nbsp;</td>
                    <td>
                        &nbsp;</td>
                    <td>
                        &nbsp;</td>
                    <td>
                        &nbsp;</td>
                    <td>
                        &nbsp;</td>
                    <td>
                        &nbsp;</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<script>
    jQuery.getScript( '/workflow/request/ux/ux.js' );
    jQuery.getScript( '/workflow/request/ux/fns.js' );
    jQuery.getScript('/workflow/request/js/FnTrans.js');
    my_zhaodaiFee="";
    my_qitaFee="";
    my_dangqianFee="";
    my_ifbusiness=false;
    var alertFlag=""
    //获取所有选择项目
    function getXM(){
        var vs = [];
        jQuery.each(jQuery( 'select[name^=field6360]' ),function(i,n){
            var v = jQuery(n).val();
            vs[i]=v;
        });
        return vs;
    }
    function xmchange(){
        var vs = getXM();
        if(Fns.checkRequest( vs )){
            cTool.setMust( "field5979" );
        }else{
            cTool.setNoMust( "field5979" );
        }
    }

    function addRow(i){
        addRow0(i);
        //jQuery( 'select[name^=field6360]' ).unbind('change',xmchange).bind( 'change' , xmchange );
    }
    jQuery(document).ready(function(){

        var objfjzs = 'field5962';
        var detailneedflag=false;
        function initDetail( i , needflag ){
            if(jQuery( "[name^=check_node_" + i + "]" ).size()==0){
            }else{
                //xmchange();
            }
            detailneedflag = needflag;
        }
        //明细必填
        function _detailneed( i ){
            if (jQuery( '#oTable' + i ).size()==1){
                var s = jQuery( '#oTable' + i + ' [name^=dtl_id]' ).size();
                if(s==0)alert("明细数据未填写！");
                return s > 0;
            }
            return true;
        }
        var objyfze='field6331',objbxje = 'field6333',objn1role='field6447',objns=['field6448','field6449','field6450','field6451','field6452','field6453'];
        //处理路径
        function initLocal(){
            var vs =[],ps=[],bqd=(getVal('field6481')=='02'),vbxje=getVal(objyfze)||getVal(objbxje),roles;
            vs = getXM();
            var r = Fns.computeLocation( vs , vbxje , bqd );
            roles = r.role.join(",");
            jQuery( '#' + objn1role ).val(roles);
            jQuery.each( r.flag , function(i,n){
                jQuery( '#' + objns[i] ).val( n );
            })
        }
        //取值
        function getVal( obj ){
            if( jQuery('#'+obj).size() > 0 ){
                if( jQuery( '#' + obj).attr('tagName') == 'select' )
                    return jQuery('#'+obj + ' option:selected').val();
                return jQuery('#'+obj).val();
            }
            if( jQuery('#dis'+obj).size() > 0 ){
                if( jQuery( '#dis' + obj).attr('tagName') == 'select' )
                    return jQuery('#dis'+obj + ' option:selected').val();
                return jQuery('#dis'+obj).val();
            }
            if( jQuery('#'+obj +'span').size() > 0 ){
                return jQuery('#'+obj +'span').html();
            }
            return '';
        }
        var candetail=false,vjs='80',objcjrjs="field6692",objcbzx="field6414",objcbzxdt="field6473";
        //获取创建人角色
        function initCreateRole(){
            Fns.getCreateRole(function(json){
                if( json.success ){
                    cTool.setVal( objcjrjs , json.roles );
                    initCbzxDt();
                }
            });
        }
        //设置是否允许更改明细中的成本中心
        function initCbzxDt(){
            //明细中成本中心是否显示
            var v = getVal(objcjrjs),vs=v.split(',');

            candetail = (jQuery.inArray( vjs,vs )>=0);
            if( candetail ){
                jQuery('.cbzx').show();
            }
        }
        //校验是否超过申请金额
        function checkJe(){
            var objsqsqje="field5980",objbxje="field6333";
            var vsq=cTool.getVal( objsqsqje ),vbx=cTool.getVal( objbxje );
            if ( vsq > 0 ){
                if((vbx - vsq) > 0 ){
                    alert("超过申请金额，不能提交！");
                    return false;
                }
            };
            return true;
        }
        //获取成本中心的相关信息
        function cbzxChange(){
            var uid = cTool.getVal( objcbzx );
            if(uid=="")
                return;
            jQuery.getJSON( "/workflow/request/ajax/getUnitFns.jsp?uid=" + uid,{_t:new Date()},function(json){
                if( json.success ){
                    cTool.setVal( "field6481" , json.departmentcode.substr(0,2) );
                    cTool.setVal( "field6661" , json.supdepid );
                    cTool.setVal( "field6662" , json.coadjutant );
                    cTool.setVal( "field6413" , json.cbzxsprjs);
                }else{
                    alert("系统错误，请联系管理员。错误说明：" + json.mess);
                }
            })
        }
        var cbzxChangeHandle;
        function _cbzxChange(){
            if( cbzxChangeHandle ){
                clearTimeout( cbzxChangeHandle );
            }
            cbzxChangeHandle  = setTimeout( cbzxChange , 100 );
        }


        function findValidationId(val) {///base/findInvoiceTypById.jsp?fieldVal=3
            var msg = "";
            $.ajax({
                type:"GET",
                url:"/aes/getAss.jsp?",
                data: {'val':val,'timeStamp':new Date().getTime()},
                dataType:"text",
                async:false,
                success:function(data){
                    var str=JSON.stringify(data);
                    msg=str.substring(str.indexOf("body>")+29,str.indexOf("</body")-8);
                    console.log("msg::"+msg);
                    console.log("\"true\"==msg"+("true"==msg));
                    if("true"==msg){
                        console.log("setFlag");
                        alertFlag="true";
                        console.log("alertFlag::"+alertFlag);
                    }
                },
                error:function(jqXHR){
                    alert("发生错误："+ jqXHR.status);
                }
            });
        }

        //表单提交校验函数
        checkCustomize = function(){


            console.log("checkCustomize::")
            showInfo();
            var bxJe_field="#field6333"//报销金额
            var hzJe_field="#field9518";//发票汇总金额
            var purchaser_field="#field9092"//销售方名称
            var bxje=$(bxJe_field).val();
            var hzje=$(hzJe_field).val();
            console.log("bxje::"+bxje)
            console.log("hzje::"+hzje)
            if(Number(bxje)>Number(hzje)){
                alert("报销总金额不能大于发票汇总金额！！！")
                return false;
            }

            alertFlag="false"
            var num = $("#submitdtlid1").val();
            num = num.split(",")
            for (var i = 0; i < num.length; i++) {
                var val = $(purchaser_field+"_"+num[i]).val();
                console.log("$(purchaser_field+\"_\"+num[i])::"+purchaser_field+"_"+num[i])
                console.log("val::"+val)
                findValidationId(val);
            }
            console.log("alertFlag::"+alertFlag)
            if("true"==alertFlag){
                alert("识别关联企业发票");
            }

            var requestidtemp3 = "0";
            //if(jQuery("#requestid").length){
            //存在
            requestidtemp3 = jQuery("#requestid").val();
            //}
//alert("1       " + requestidtemp3);
            var prerequestidtemp3 ="0";
//alert("1.25 "+jQuery("#field5979").length);
//alert("1.3       " +jQuery("#field5979").val());


            if(jQuery("#field5979").val()!=""){
//alert("1.5 "+jQuery("#field5979").length);

                prerequestidtemp3 = jQuery("#field5979").val();
            }
//alert("2       " + prerequestidtemp3 );

            var checkval3 = checkpreworkflow3(prerequestidtemp3);
//alert("3       " + checkval3 );
            if((checkval3!="nodeerror2")&&(prerequestidtemp3!="0")&&(checkval3!="nodeerror1")&&(checkval3!="notfit")){
                alert("事前申请流程应该在归档节点!");
                return false;
            }
            var checkval4 = checkpreworkflow4(prerequestidtemp3,requestidtemp3);


            var _xm_array111 = jQuery("select[name^='field6360']");
            if(_xm_array111.length<=0){
                alert("必须填写一条明细");
                return false;
            }
            //成本中心赋值到明细
            //if(!candetail) jQuery( '[name^=' + objcbzxdt + ']' ).val(jQuery('#' + objcbzx).val());
            if(checkOldRequest2(jQuery("#field5979").val())){
                return true;
            }

            alert("11")


            debugger

            var flag = true;
            if(detailneedflag){
                flag = _detailneed( 0 );
            };
            if( flag ) initLocal();
            //if (!checkJe()) return;


            var all1 = jQuery("#submitdtlid0").val();
            var allArray = all1.split(',');
            for(var i = 0;i<allArray.length;i++){
                var index = allArray[i];
                var ksje = jQuery("#field6360_"+index).val(); //项目
                var sfz = jQuery.trim(jQuery("#field9014_"+index).val());//业务流程
                if(ksje != '' && ksje != null && ksje != undefined){
                    if(ksje ==53 && sfz == ''){//项目为业务招待费，业务流程为空
                        alert('项目为业务招待费时，业务流程必须填写');
                        return false;
                    }
                }
            }

            //预提预算：如果申请金额大于事前申请金额，false 如果预算所属年、成本中心、项目跟事前申请流程对应，false
            //事前申请流程=5979  项目=6360  预算所属年=7000 申请部门(成本中心)=6473 明细  项目大类=6998
            if(jQuery("#field6998").val()=="0" || jQuery("#field6998").val()=="1" || jQuery("#field6998").val()=="2" || jQuery("#field6998").val()=="12"){
                if(jQuery("#field5979").val()==""){
                    alert("\"事前申请流程\"未填写!");
                    return false;
                }

                //申请支付金额=6333  事前申请金额=5980
                //if(parseFloat(jQuery("#field6333").val())>parseFloat(jQuery("#field5980").val())){
                //alert("申请金额大于事前申请金额!");
                //return false;
                //}
                var requestidtemp = jQuery("#field5979").val();
                var fnayeartemp = jQuery("#field7000").val();
                var fnadepttemp = "";
                var projectidtemp = "";
                var numstemp = document.getElementById("indexnum0").value * 1.0 - 1;
                var tempamount = 0;
                var details = 0;
                var requestidtemp2 = "0";
                if(jQuery("#requestid").length){
                    //存在
                    requestidtemp2 = jQuery("#requestid").val();
                }
                //for(var i=0;i<=numstemp;i++){
                var _xm_array = jQuery("select[name^='field6360_']");
                var i=0;
                for(var i0=0;i0<_xm_array.length;i0++){
                    i = parseInt(jQuery(_xm_array[i0]).attr("name").replace("field6360_",""));
                    if(jQuery("#field6360_"+i).length ){
                        projectidtemp = jQuery("#field6360_"+i).val();
                        fnadepttemp = jQuery("#field6473_"+i).val();
                        if(projectidtemp!=33 && projectidtemp!=31 &&
                            projectidtemp!=1 && projectidtemp!=2 && projectidtemp!=3 && projectidtemp!=4 && projectidtemp!=5 &&
                            projectidtemp!=6 && projectidtemp!=7 && projectidtemp!=8 ){
                            alert("明细中存在不需要事前申请的费用项目！");
                            return false;
                        }

                        var prerequestidtemp2 = jQuery("#field5979").val();
                        var fnayeartemp2 = jQuery("#field7000").val();
                        var fnadepttemp2 = jQuery("#field6473_"+i).val();
                        var projectidtemp2 = jQuery("#field6360_"+i).val();
                        var feetemp2 = jQuery("#field6362_"+i).val();
                        feetemp2= getJe_fee_judge_fywbm(i);
                        var checkval2 = checkpreworkflow2(prerequestidtemp2,requestidtemp2,fnayeartemp2,fnadepttemp2,projectidtemp2,feetemp2);
                        if(checkval2=="nodeerror"){
                            alert("第"+(i0+1)+"行明细,事前申请流程应该在会计做账节点!");
                            return false;
                        }else if(checkval2=="nofit"){
                            alert("第"+(i0+1)+"行明细,预算所属年、成本中心、项目跟事前申请流程应该对应!");
                            return false;
                        }else if(checkval2=="over"){
                            alert("第"+(i0+1)+"行明细,申请金额大于可用事前申请金额!");
                            return false;
                        }

                    }
                }


            }else if(jQuery("#field6998").val()=="7" && jQuery("#field6999").val()=="2"){
                var numstemp = document.getElementById("indexnum0").value * 1.0 - 1;
                var requestidtemp2 = "0";
                if(jQuery("#requestid").length){
                    //存在
                    requestidtemp2 = jQuery("#requestid").val();
                }
                //for(var i=0;i<=numstemp;i++){
                var _xm_array = jQuery("select[name^='field6360_']");
                var i=0;
                for(var i0=0;i0<_xm_array.length;i0++){
                    i = parseInt(jQuery(_xm_array[i0]).attr("name").replace("field6360_",""));
                    if(jQuery("#field6360_"+i).length ){
                        var prerequestidtemp2 = jQuery("#field5979").val();
                        var fnayeartemp2 = jQuery("#field7000").val();
                        var fnadepttemp2 = jQuery("#field6473_"+i).val();
                        var projectidtemp2 = jQuery("#field6360_"+i).val();
                        var feetemp2 = jQuery("#field6362_"+i).val();
                        feetemp2= getJe_fee_judge_fywbm(i);
                        var checkval2 = checkpreworkflow2(prerequestidtemp2,requestidtemp2,fnayeartemp2,fnadepttemp2,projectidtemp2,feetemp2);
                        if(checkval2=="nodeerror"){
                            alert("第"+(i0+1)+"行明细,事前申请流程应该在会计做账节点!");
                            return false;
                        }else if(checkval2=="nofit"){
                            alert("第"+(i0+1)+"行明细,预算所属年、成本中心、项目跟事前申请流程应该对应!");
                            return false;
                        }else if(checkval2=="over"){
                            alert("第"+(i0+1)+"行明细,申请金额大于可用事前申请金额!");
                            return false;
                        }
                    }
                }


            }else{//如果金额大于可用预算额不能提交

                for(var ii=0;ii<2;ii++){
                    var checktemp = checkIfOver();
                    //alert("调试信息：ii="+ii+";;;checktemp="+checktemp);
                    var _checkIfOver_error_info_rownumberinfo = "";
                    try{
                        if(_checkIfOver_error_info_rownumber!=null&&_checkIfOver_error_info_rownumber!=""){
                            _checkIfOver_error_info_rownumberinfo = "第"+_checkIfOver_error_info_rownumber+"行所属部门：";
                        }
                    }catch(ex1){}
                    if(checktemp=="1"){
                        alert(_checkIfOver_error_info_rownumberinfo+"业务招待费与其他费用合计总额已超标");
                        if(ii==1){
                            return false;
                        }
                    }else if(checktemp=="2"){
                        if(ii<1){
                            alert(_checkIfOver_error_info_rownumberinfo+"业务招待费预算已超额，请注意！");
                        }
                        if(ii==1){
                            return true;
                        }
                    }else if(checktemp=="3"){
                        alert(_checkIfOver_error_info_rownumberinfo+"业务招待费与其他费用合计总额已超标");
                        if(ii==1){
                            return false;
                        }
                    }else if(checktemp=="4"){
                        alert(_checkIfOver_error_info_rownumberinfo+"项目申请金额大于可用预算额!");
                        if(ii==1){
                            return false;
                        }
                    }
                }

            }

            return flag;
        }

        function _pageinit(){
            Fns.initNo();
            initCreateRole();
            if(cTool.isCreate()) _cbzxChange();
            //jQuery( "#" + objcbzx ).bind( 'propertychange' , _cbzxChange );
            jQuery( "#" + objcbzx ).bindPropertyChange( _cbzxChange );
            //jQuery( 'select[name^=field6360]' ).bind( 'change' ,xmchange);
            //xmchange();
            cTool.protect('field5980');
            jQuery('.inputstyle,.Inputstyle').not('select,#field5962').css( { width:"100%","margin-right":"20px" } );
            jQuery( '#' + objfjzs ).css('text-align','center').blur();
            initDetail( 0 , true );
        }
        setTimeout(_pageinit,100);

    })

    function checkOldRequest2(requestid){
        var returnval=false;
        jQuery.ajax({
            url : "/workflow/request/CheckIfOldRequest2.jsp",
            type : "post",
            async : false,
            processData : false,
            data : "requestid="+requestid,
            dataType : "html",
            success: function do4Success(msg){
                returnval=false;
                if(msg == "true"){
                    returnval=true;
                }
            }
        });
        return returnval;
    }

    function checkOldRequest(requestid){
        var returnval=false;
        jQuery.ajax({
            url : "/workflow/request/CheckIfOldRequest.jsp",
            type : "post",
            async : false,
            processData : false,
            data : "requestid="+requestid,
            dataType : "json",
            success: function do4Success(msg){
                var infos = msg;
                returnval=infos;
            }
        });
        return returnval;
    }
</script><script>
    var yincangZd="#field9497,#field9085,#field9086,#field9088,#field9090,#field9524,#field9499,#field9493,#field9094,#field9096,#field9525,#field9500,#field9535,#field9113,#field9532,#field9092,#field9095,#field9113";//影藏字段 写法  #field1231,#field1231,#field1231
    var detileTabId = "#submitdtlid1";//明细2：submitdtlid1   明细1：submitdtlid0
    var dtIdLength = 0;
    var oldDtIdLength = 0;

    jQuery(document).ready(function(){
        var num = $(detileTabId).val();
        num = num.split(",")
        var zds= yincangZd.split(",")
        for (var j = 0; j < num.length; j++) {
            for (var i = 0; i < zds.length; i++) {
                yingCang(num[j],zds[i]);
            }
        }
        /*
    当明细行数量增加时，为增加的明细行添加函数；当明细行数量减少时，重新计算总额
     */
        $(detileTabId).bindPropertyChange(function () {
            console.log("bindPropertyChange")
            dtIdLength = jQuery(detileTabId).val().split(",").length;
            if (oldDtIdLength <= dtIdLength) {
                var num = $(detileTabId).val();
                num = num.split(",")
                var zds= yincangZd.split(",")
                for (var j = num.length-1; j >=0; j--) {
                    for (var i = 0; i < zds.length; i++) {
                        yingCang(num[j],zds[i]);
                    }
                }
                oldDtIdLength = dtIdLength;
            }
            if (oldDtIdLength > dtIdLength) {
                oldDtIdLength = dtIdLength;
            }
        });
    })

    /*
    当明细行数量增加时，为增加的明细行添加函数；当明细行数量减少时，重新计算总额
     */
    /*$(detileTabId).bindPropertyChange(function () {
        console.log("bindPropertyChange")
        dtIdLength = jQuery(detileTabId).val().split(",").length;
        if (oldDtIdLength <= dtIdLength) {
            var num = $(detileTabId).val();
            num = num.split(",")
            var zds= yincangZd.split(",")
            for (var j = num.length-1; j >=0; j--) {
                for (var i = 0; i < zds.length; i++) {
                    yingCang(num[j],zds[i]);
                }
            }
            oldDtIdLength = dtIdLength;
        }
        if (oldDtIdLength > dtIdLength) {
            oldDtIdLength = dtIdLength;
        }
    });*/

    function yingCang(index,col) {
        console.log("yingCang")
        console.log("col+\"_\"+index::"+col+"_"+index)
        var labelId = "labe"+col.replace("#field","")
        $(col+"_"+index).parent("td").attr("style","display:none")
        $(labelId).parent("td").attr("style","display:none")
    }

    function showInfo() {
        console.log("file showInfo::")
        /*//明细
       var jshjField="#field9099";//价税合计字段
       var invoiceTypeField="#field9484"//费用类型
       var territoryField="#field9523";//境外出差
       var timeField="#field9486";//时间段
       var mobileField="#field9487";//手机号
       var zymcField="#field9108";//摘要名称

       var producerField="#field9531"//监制章
       var sfyzField="#"//是否有章
       //主表
       var bxr="#field6557";//报销人
       var ccrq="#field6009"//出差日期
       var fhrq="#field6010";//
       var ewsm=""//07
       var shiyou=""//07*/
        var fields="#field9084,#field9492,#field9525,#field9493,#field9499,#field9094,#field9532,#field9524";//顺序参照为上述注释明细从上到下 6  7 9     4
        var mainFields="";//顺序参照为上述注释主表从上到下  但是07 只配置ewsm，shiyou ，06，09 只配置bxr，ccrq，fhrq  其他流程不配置
        var errField="#field9535";//失败原因
        var index=4;// 示列： 06 就配置 6
        console.log("fields::"+fields)
        console.log("mainFields::"+mainFields)
        console.log("index::"+index)

        var num = $("#submitdtlid1").val();
        num = num.split(",")
        var jsonArr = new Array();
        var fieldArr = fields.split(",")
        var mainArr = mainFields.split(",")
        for (var i = 0; i < num.length; i++) {//jshj,invoiceType zymc  //bxr  ccrq   fhrq   //territory//time  fksy   ccsy  ewsm  shiyou//mobile
            var count=0;
            var imap={}
            if("9"==index||"6"==index||"7"==index){
                /*console.log("fieldArr[count++]+\"_\"+num[i]  jshj::"+(fieldArr[0]+"_"+num[i]))
                                   console.log("fieldArr[count++]+\"_\"+num[i]  zymc::"+(fieldArr[5]+"_"+num[i]))*/
                imap.jshj=$(fieldArr[count++]+"_"+num[i]).val()
                imap.invoiceType=$(fieldArr[count++]+"_"+num[i]).val()
                imap.territory=$(fieldArr[count++]+"_"+num[i]).val()
                imap.time=$(fieldArr[count++]+"_"+num[i]).val()
                imap.mobile=$(fieldArr[count++]+"_"+num[i]).val()
                imap.zymc=$(fieldArr[count++]+"_"+num[i]).val()
                imap.producer=$(fieldArr[count++]+"_"+num[i]).val()
                imap.sfyz=$(fieldArr[count++]+"_"+num[i]).val()
                console.log("imap::"+imap);
                jsonArr[i]=imap;
            }else{
                imap.producer=$(fieldArr[0]+"_"+num[i]).val()
                imap.sfyz=$(fieldArr[1]+"_"+num[i]).val()
                jsonArr[i]=imap;
            }
        }
        var mainMap={}
        if("9"==index||"6"==index){
            mainMap.bxr=$(mainArr[0]).val();
            mainMap.ccrq=$(mainArr[1]).val();
            mainMap.fhrq=$(mainArr[2]).val();
        }else if("7"==index){
            mainMap.ewsm=$(mainArr[0]).val();
            mainMap.shiyou=$(mainArr[1]).val();
        }
        var jsonMain = "["+JSON.stringify(mainMap)+"]";
        var jsonDetail=JSON.stringify(jsonArr);
        console.log("jsonMain::"+jsonMain);
        console.log("jsonDetail::"+jsonDetail);
        findMsg(jsonMain,jsonDetail,index,errField);
    }

    /**
     * 后台提交查询提示
     * @param val
     */
    function findMsg(jsonMain,jsonDetail,type,errField) {///base/findInvoiceTypById.jsp?fieldVal=3
        var msg = "";
        $.ajax({
            type:"GET",
            url:"/aes/getAlertInfo.jsp?",
            data: {'jsonMain':jsonMain,"jsonDetail":jsonDetail,jsType:type,'timeStamp':new Date().getTime()},
            dataType:"text",
            async: false,
            success:function(data){
                var str=JSON.stringify(data);
                console.log("str::"+str)
                msg=str.substring(str.indexOf("<body>")+18,str.indexOf("</body>")-4);
                console.log("msg::"+msg)
                if(msg.length>4){
                    //$(errField).val(msg)
                    var ms=""
                    var msgArr = msg.split("_")
                    console.log("msgArr::"+msgArr.length)
                    for(var i=0;i<msgArr.length;i++){
                        var msi=msgArr[i];
                        console.log("msi::"+msi)
                        if(msi.indexOf(":")!=-1){
                            var msiArr = msi.split(":");
                            var colIndex = msiArr[0].substring(1,2)
                            var index = $("#oTable1 tbody tr[_target='datarow']").eq(Number(colIndex)-1).attr("_rowindex")
                            console.log("index::"+index)
                            console.log("msiArr[1]"+msiArr[1])
                            $(errField+"_"+index).val(msiArr[1]);
                        }
                        ms=ms+msi+"\n";
                    }
                    console.log("ms::"+ms)
                    alert(ms)
                }
            },
            error:function(jqXHR){
                alert("发生错误："+ jqXHR.status);
            }
        });
    }


</script>