<p>
    <style type="text/css">
        .detailAddTd{
            height : 60px;
        }
        .wfcontainer{
            text-align:center;
            width:100%;
            margin:0 auto;
        }
        .wfpage{
            width:960;
            text-align:center;
            margin:0 auto;
        }
        .wfnocon{
            width:100%;
            padding:0 20px;
        }
        .wfid{
            float:left;
        }
        .wfno{
            float:right;
        }
        .wftitle{
            font-family:Verdana;
            font-size:16pt;
            font-weight:bold;
            text-align:center;
            padding:15px;
            width:100%;
        }
        .wfmain{

        }
        .wfmaintable{
            font-size:9pt;
            border-collapse:collapse;
            width:100%;
        }
        .wfdetailcon{
            padding:0;
            margin:0;
        }
        .wfdetail{
            width:100%;
        }
        .wfdetailbtncon{
            width:100%;
            text-align:right;
            padding-right:20px;
        }
        .wfdetailtable{
            font-size:9pt;
            border-collapse:collapse;
            width:100%;
        }
        .fieldrow{
            height:40px;
        }
        .fieldlabel{
            border: #CBCDCA solid 1px;
            background-color:#eeeeee;
            height:30px;
            text-align:center;
            padding:5px 10px;
        }
        .fieldvalue{
            border: #CBCDCA solid 1px;
            text-align:left;
            padding:5px 10px;
        }
        .fielddetail{
            width:100%;
            border: #CBCDCA solid 1px;
        }
        .detailtitle{
            background-color:#E0EEEE;
            text-align:center;
            border: #CBCDCA solid 1px;
            height:30px;
        }
        .hide {
            display: none;
            height: 0px;
        }	</style>
</p>
<p class="hide">
    1&nbsp;<input class="InputStyle" id="$field7011$" name="field7011" type="text" value="[可编辑]依次审批" /><input class="InputStyle" id="$field6415$" name="field6415" type="text" value="[可编辑]申请人角色" /> <input class="InputStyle" id="$field6459$" name="field6459" type="text" value="[可编辑]节点2审批角色" /> <input class="InputStyle" id="$field6460$" name="field6460" type="text" value="[可编辑]节点2标志" /> <input class="InputStyle" id="$field6461$" name="field6461" type="text" value="[可编辑]节点3标志" /> <input class="InputStyle" id="$field6462$" name="field6462" type="text" value="[可编辑]节点4标志" /> <input class="InputStyle" id="$field6463$" name="field6463" type="text" value="[可编辑]节点5标志" /> <input class="InputStyle" id="$field6464$" name="field6464" type="text" value="[可编辑]节点6标志" /> <input class="InputStyle" id="$field6465$" name="field6465" type="text" value="[可编辑]节点7标志" /> <input class="InputStyle" id="$field6479$" name="field6479" type="text" value="[可编辑]事前申请流程类型" /> <input class="InputStyle" id="$field6480$" name="field6480" type="text" value="[可编辑]事前申请流程审批标志" /> <input class="InputStyle" id="$field6482$" name="field6482" type="text" value="[可编辑]成本中心编号" /> <input class="InputStyle" id="$field6657$" name="field6657" type="text" value="[可编辑]成本中心上级部门" /> <input class="InputStyle" id="$field6658$" name="field6658" type="text" value="[可编辑]成本中心审批人" /> <input class="InputStyle" id="$field6693$" name="field6693" type="text" value="[可编辑]创建人角色" /><input class="InputStyle" id="$field7723$" name="field7723" type="text" value="[可编辑]依次审批-季总" /><input class="InputStyle" id="$field7808$" name="field7808" type="text" value="[可编辑]依次审批（王翟）" /><input class="InputStyle" id="$field7809$" name="field7809" type="text" value="[可编辑]依次审批（吉翟）" /><input class="InputStyle" id="$field7915$" name="field7915" type="text" value="[可编辑]依次审批-季舒" /><input class="InputStyle" id="$field8007$" name="field8007" type="text" value="[可编辑]依次审批-姚丁" />1</p>
<div class="wfcontainer">
    <div class="wfpage">
        <div class="wfnocon">
            <div class="wfid">
                &nbsp;</div>
            <div class="wfno">
                &nbsp;编号：<input class="InputStyle" id="$field6485$" name="field6485" type="text" value="[只读]编号" /></div>
        </div>
        <div class="wftitle">
            陆家嘴国际信托有限公司<br />
            现金报销表</div>
        <div>
            <table style="width: 100%; height: 100%;">
                <tbody>
                <tr>
                    <td style="width: 60px; text-align: right;">
                        成本中心</td>
                    <td style="width: 240px; text-align: center;">
                        <input class="InputStyle" id="$field6416$" name="field6416" type="text" value="[必填]成本中心" /></td>
                    <td>
                        &nbsp;预算年度&nbsp;<input class="InputStyle" id="$field7005$" name="field7005" type="text" value="[可编辑]预算年度" />&nbsp;年</td>
                    <td style="width: 80px; text-align: right;">
                        附件</td>
                    <td style="width: 80px; text-align: center;">
                        <input class="InputStyle" id="$field6033$" name="field6033" type="text" value="[必填]附件" /></td>
                    <td style="width: 40px; text-align: left;">
                        张</td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="wfmain">
            <table cellpadding="0" cellspacing="0" class="wfmaintable">
                <colgroup>
                    <col width="120" />
                    <col width="200" />
                    <col width="120" />
                    <col width="200" />
                    <col width="120" />
                    <col width="200" />
                </colgroup>
                <tbody>
                <tr class="fieldrow">
                    <td class="fieldlabel">
                        <input class="Label" id="$label6030$" name="label6030" size="12" style="width: 96px; height: 21px;" type="text" value="申请人" /></td>
                    <td class="fieldvalue">
                        <input class="InputStyle" id="$field6030$" name="field6030" type="text" value="[只读]申请人" /></td>
                    <td class="fieldlabel">
                        <input class="Label" id="$label6701$" name="label6701" size="10" style="width: 80px; height: 21px;" type="text" value="收款人" /></td>
                    <td class="fieldvalue">
                        <input class="InputStyle" id="$field6701$" name="field6701" type="text" value="[必填]收款人" /></td>
                    <td class="fieldlabel">
                        日期</td>
                    <td class="fieldvalue">
                        <input class="InputStyle" id="$field6032$" name="field6032" type="text" value="[只读]申请日期" /></td>
                </tr>
                <tr class="fieldrow">
                    <td class="fieldlabel">
                        项目大类</td>
                    <td class="fieldvalue">
                        &nbsp;<input class="InputStyle" id="$field7003$" name="field7003" type="text" value="[必填]项目大类" /></td>
                    <td class="fieldlabel">
                        支付种类</td>
                    <td class="fieldvalue">
                        &nbsp;<input class="InputStyle" id="$field7004$" name="field7004" type="text" value="[可编辑]支付种类" /></td>
                    <td class="fieldlabel">
                        使用部门</td>
                    <td class="fieldvalue">
                        &nbsp;<input class="InputStyle" id="$field7007$" name="field7007" type="text" value="[可编辑]使用部门" /></td>
                </tr>
                <tr class="fieldrow">
                    <td class="fieldlabel" colspan="6">
                        报销类别为招待费时，请先发起<a href="http://172.16.1.239/workflow/request/AddRequest.jsp?workflowid=271&amp;isagent=0&amp;beagenter=0&amp;f_weaver_belongto_userid=" target="_blank"><font color="red">业务招待申请流程</font></a></td>
                </tr>
                <tr class="fieldrow">
                    <td class="fielddetail" colspan="6">
                        <div class="wfdetail" id="detail0">
                            <div class="wfdetailbtncon" id="div0button">
                                <button accesskey="A" class="addbtn" id="$addbutton0$" name="addbutton0" onclick="addRow0(0);" type="button"></button><button accesskey="E" class="delbtn" id="$delbutton0$" name="delbutton0" onclick="if(isdel()){deleteRow0(0);}" type="button"></button></div>
                            <table class="wfdetailtable ListStyle" id="oTable0" name="oTable0">
                                <colgroup>
                                    <col width="250" />
                                    <col width="140" />
                                    <col width="100" />
                                    <col />
                                    <col width="100" />
                                    <col width="160" />
                                </colgroup>
                                <tbody>
                                <tr>
                                    <!--明细标头 增加列时需增加一个td-->
                                    <td class="detailtitle">
                                        <input class="Label" id="$label6418$" name="label6418" type="text" value="项目" /></td>
                                    <td class="detailtitle">
                                        预算信息</td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label6035$" name="label6035" type="text" value="付款金额" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label6034$" name="label6034" type="text" value="付款用途" /></td>
                                    <td class="detailtitle">
                                        业务申请表</td>
                                    <td class="detailtitle cbzx hide">
                                        <input class="Label" id="$label6474$" name="label6474" type="text" value="成本中心" /></td>
                                </tr>
                                <tr>
                                    <!--明细数据 增加列时需增加一个td-->
                                    <td>
                                        <input class="InputStyle" id="$field6418$" name="field6418" type="text" value="[必填]项目" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field7006$" name="field7006" type="text" value="[只读]预算信息" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field6035$" name="field6035" type="text" value="[必填]付款金额" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field6034$" name="field6034" type="text" value="[必填]付款用途" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9017$" name="field9017" value="[可编辑]业务申请表" /></td>
                                    <td class="cbzx hide">
                                        <input class="InputStyle" id="$field6474$" name="field6474" type="text" value="[必填]成本中心" /></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
                <tr class="fieldrow">
                    <td class="fielddetail" colspan="7">
                        <div class="wfdetail" id="detail1">
                            <div class="wfdetailbtncon" id="div0button">
                                <button accesskey="A" class="addbtn" id="$addbutton0$" name="addbutton0" onclick="addRow1(1);" type="button"></button><button accesskey="E" class="delbtn" id="$delbutton0$" name="delbutton0" onclick="if(isdel()){deleteRow1(1);}" type="button"></button></div>
                            <table class="wfdetailtable ListStyle" id="oTable1" name="oTable1">
                                <colgroup>
                                    <col width="250" />
                                    <col width="150" />
                                    <col width="100" />
                                    <col />
                                    <col width="140" />
                                    <col width="140" />
                                </colgroup>
                                <tbody>
                                <tr>
                                    <!--明细标头 增加列时需增加一个td-->
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9137$" name="label9137" value="发票号码" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9152$" name="label9152" value="发票类型" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9143$" name="label9143" value="发票日期" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9138$" name="label9138" value="不含税金额" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9139$" name="label9139" value="税额" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9140$" name="label9140" value="价税合计" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9141$" name="label9141" value="科目" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9142$" name="label9142" value="备注" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9144$" name="label9144" value="发票代码" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9145$" name="label9145" value="付款方名称" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9146$" name="label9146" value="收款方名称" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9147$" name="label9147" value="摘要名称" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9148$" name="label9148" value="纳税人识别号" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9149$" name="label9149" value="地区" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9150$" name="label9150" value="出租车号" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9151$" name="label9151" value="发票附件" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9153$" name="label9153" value="发票时间段" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9154$" name="label9154" value="发票姓名" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9155$" name="label9155" value="境内外标记" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9156$" name="label9156" value="手机号" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9157$" name="label9157" value="发票张数" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9158$" name="label9158" value="监制章" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9159$" name="label9159" value="失败原因" /></td>
                                    <td class="detailtitle">
                                        <input class="Label" id="$label9160$" name="label9160" value="是否有章" /></td>
                                </tr>
                                <tr>
                                    <!--明细数据 增加列时需增加一个td-->
                                    <td>
                                        <input class="InputStyle" id="$field9137$" name="field9137" value="[可编辑]发票号码" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9152$" name="field9152" value="[可编辑]发票类型" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9143$" name="field9143" value="[可编辑]发票日期" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9138$" name="field9138" value="[可编辑]不含税金额" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9139$" name="field9139" value="[可编辑]税额" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9140$" name="field9140" value="[可编辑]价税合计" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9141$" name="field9141" value="[可编辑]科目" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9142$" name="field9142" value="[可编辑]备注" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9144$" name="field9144" value="[可编辑]发票代码" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9145$" name="field9145" value="[可编辑]付款方名称" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9146$" name="field9146" value="[可编辑]收款方名称" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9147$" name="field9147" value="[可编辑]摘要名称" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9148$" name="field9148" value="[可编辑]纳税人识别号" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9149$" name="field9149" value="[可编辑]地区" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9150$" name="field9150" value="[可编辑]出租车号" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9151$" name="field9151" value="[可编辑]发票附件" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9153$" name="field9153" value="[可编辑]发票时间段" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9154$" name="field9154" value="[可编辑]发票姓名" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9155$" name="field9155" value="[可编辑]境内外标记" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9156$" name="field9156" value="[可编辑]手机号" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9157$" name="field9157" value="[可编辑]发票张数" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9158$" name="field9158" value="[可编辑]监制章" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9159$" name="field9159" value="[可编辑]失败原因" /></td>
                                    <td>
                                        <input class="InputStyle" id="$field9160$" name="field9160" value="[可编辑]是否有章" /></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </td>
                </tr>
                <tr class="fieldrow">
                    <td class="fieldlabel">
                        发票汇总金额</td>
                    <td class="fieldvalue" colspan="3">
                        <input class="InputStyle" id="$field9136$" name="field9136" value="[可编辑]发票汇总金额" /></td>
                </tr>
                <tr class="fieldrow">
                    <td class="fieldlabel">
                        合计</td>
                    <td class="fieldvalue" colspan="3">
                        <input class="InputStyle" id="$field6466$" name="field6466" type="text" value="[可编辑]报销金额大写" /></td>
                    <td class="fieldvalue" colspan="2">
                        <input class="InputStyle" id="$field6039$" name="field6039" type="text" value="[可编辑]报销金额" /></td>
                </tr>
                <tr class="fieldrow">
                    <td class="fieldlabel">
                        事前申请流程</td>
                    <td class="fieldvalue" colspan="3">
                        <input class="InputStyle" id="$field6036$" name="field6036" type="text" value="[可编辑]相关请求" /></td>
                    <td class="fieldlabel">
                        事前申请金额</td>
                    <td class="fieldvalue">
                        <input class="InputStyle" id="$field6037$" name="field6037" type="text" value="[只读]原支出申请金额" /></td>
                </tr>
                <tr class="fieldrow">
                    <td class="fieldlabel">
                        事前申请事由</td>
                    <td class="fieldvalue" colspan="5">
                        <input class="InputStyle" id="$field6677$" name="field6677" type="text" value="[可编辑]事由" /></td>
                </tr>
                <tr class="fieldrow">
                    <td class="fieldlabel">
                        附件</td>
                    <td class="fieldvalue" colspan="5">
                        <input class="InputStyle" id="$field6488$" name="field6488" type="text" value="[可编辑]附件" /></td>
                </tr>
                <tr class="fieldrow">
                    <td class="fieldlabel">
                        额外说明</td>
                    <td class="fieldvalue" colspan="5">
                        <input class="InputStyle" id="$field6691$" name="field6691" type="text" value="[可编辑]额外说明" /></td>
                </tr>
                <tr style="height: 0px;">
                    <td>
                        &nbsp;</td>
                    <td>
                        &nbsp;</td>
                    <td>
                        &nbsp;</td>
                    <td>
                        &nbsp;</td>
                    <td>
                        &nbsp;</td>
                    <td>
                        &nbsp;</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<script type="text/javascript">
    jQuery.getScript( '/workflow/request/ux/ux.js' );
    jQuery.getScript( '/workflow/request/ux/fns.js' );
    jQuery.getScript('/workflow/request/js/FnTrans.js');
    my_zhaodaiFee="";
    my_qitaFee="";
    my_dangqianFee="";
    my_ifbusiness=false;
    var alertFlag=""
    //获取所有选择项目
    function getXM(){
        var vs = [];
        jQuery.each(jQuery( 'select[name^=field6418]' ),function(i,n){
            var v = jQuery(n).val();
            vs[i]=v;
        });
        return vs;
    }
    function xmchange(){
        var vs = getXM();
        if(Fns.checkRequest( vs )){
            cTool.setMust( "field6036" );
        }else{
            cTool.setNoMust( "field6036" );
        }
    }

    function addRow(i){
        addRow0(i);
        //jQuery( 'select[name^=field6418]' ).unbind('change',xmchange).bind( 'change' , xmchange );
    }
    jQuery(document).ready(function(){
        var objfjzs = 'field6033';
        var detailneedflag=false;
        function initDetail( i , needflag ){
            if(jQuery( "[name^=check_node_" + i + "]" ).size()==0){
            }
            detailneedflag = needflag;
        }
        //明细必填
        function _detailneed( i ){
            if (jQuery( '#oTable' + i ).size()==1){
                var s = jQuery( '#oTable' + i + ' [name^=dtl_id]' ).size();
                if(s==0)alert("明细数据未填写！");
                return s > 0;
            }
            return true;
        }

        var objbxje = 'field6039',objn1role='field6459',objns=['field6460','field6461','field6462','field6463','field6464','field6465'];
        //处理路径
        function initLocal(){
            var vs =[],ps=[],bqd=(getVal('field6482')=='02'),vbxje=getVal(objbxje);
            vs = getXM();
            var r = Fns.computeLocation( vs , vbxje , bqd );
            roles = r.role.join(",");
            jQuery( '#' + objn1role ).val(roles);
            jQuery.each( r.flag , function(i,n){
                jQuery( '#' + objns[i] ).val( n );
            })
        }
        //报销金额大小写
        var objbxjedx="field6466";

        //报销金额转换为大写
        function bxjechange(){
            var v = getVal(objbxje );
            var vc = numberChangeToChinese( v );
            setVal( objbxjedx , vc );
        }
        //取值
        function getVal( obj ){
            if( jQuery('#'+obj).size() > 0 ){
                if( jQuery( '#' + obj).attr('tagName') == 'select' )
                    return jQuery('#'+obj + ' option:selected').val();
                return jQuery('#'+obj).val();
            }
            if( jQuery('#dis'+obj).size() > 0 ){
                if( jQuery( '#dis' + obj).attr('tagName') == 'select' )
                    return jQuery('#dis'+obj + ' option:selected').val();
                return jQuery('#dis'+obj).val();
            }
            if( jQuery('#'+obj +'span').size() > 0 ){
                return jQuery('#'+obj +'span').html();
            }
            return '';
        }
        function setVal( obj , v ){
            if( jQuery( '#' + obj).size() == 0 ){
                jQuery( '#' + obj+ 'span' ).html(v);
            }else{
                jQuery( '#' + obj).val(v);
                jQuery( '#' + obj).change();
                if( jQuery( '#' + obj).attr('type') == 'hidden' ){
                    var span = jQuery( '#' + obj+ 'span' );
                    if( span){
                        span.html(v);
                    }else{
                        jQuery( '#' + obj).before("<span id='" + '#' + obj + 'span' + "'>" + v + "</span>");
                    };
                };
            }
        };

        var candetail=false,vjs='80',objcjrjs="field6693",objcbzx="field6416",objcbzxdt="field6474";

        //设置是否允许更改明细中的成本中心
        function initCbzxDt(){
            //明细中成本中心是否显示
            var v = getVal(objcjrjs),vs=v.split(',');

            candetail = (jQuery.inArray( vjs,vs )>=0);
            if( candetail ){
                jQuery('.cbzx').show();
            }
        }

        //校验是否超过申请金额
        function checkJe(){
            var objsqsqje="field6037",objbxje="field6039";
            var vsq=cTool.getVal( objsqsqje ),vbx=cTool.getVal( objbxje );
            if ( vsq > 0 ){
                if((vbx - vsq) > 0 ){
                    alert("超过申请金额，不能提交！");
                    return false;
                }
            };
            return true;
        }
//获取创建人角色
//function initCreateRole(){
        //Fns.getCreateRole(function(json){
        //	if( json.success ){
        //		cTool.setVal( objcjrjs , json.roles );
        //		initCbzxDt();
        //	}
        //});
//}
//获取创建人角色
        function initCreateRole(){
            jQuery.ajax({
                url : "/workflow/request/ajax/getUserRole.jsp",
                type : "post",
                async : false,
                processData : false,
                dataType : "html",
                success: function do4Success(json1){
                    json1 =  eval("(" + json1.trim() + ")")
                    if(json1.success) {
                        var vs1 = json1.roles.split(',');
                        var  candetail1 = (jQuery.inArray( vjs,vs1 )>=0);
                        if(candetail1){
                            jQuery('.cbzx').show();
                        }
                    }
                }
            });
        }


        //获取成本中心的相关信息
        // function cbzxChange(){
        //  var uid = cTool.getVal( objcbzx );
        //   if(uid=="")
        //     return;
        //   jQuery.getJSON( "/workflow/request/ajax/getUnitFns.jsp?uid=" + uid,function(json){
        //     if( json.success ){
        //       cTool.setVal( "field6482" , json.departmentcode.substr(0,2) );
        //        cTool.setVal( "field6657" , json.supdepid );
        //       cTool.setVal( "field6658" , json.coadjutant );
        //       cTool.setVal( "field6415" , json.cbzxsprjs);
        //     }else{
        //        alert("系统错误，请联系管理员。错误说明：" + json.mess);
        //      }
        // })
        //}

//获取成本中心的相关信息
        function cbzxChange(){
            var uid = cTool.getVal( objcbzx );
            if(uid=="")
                return;

            jQuery.ajax({
                url : "/workflow/request/ajax/getUnitFns.jsp?uid=" + uid,
                type : "post",
                async : false,
                processData : false,
                dataType : "html",
                success: function do4Success(json1){
                    json1 =  eval("(" + json1.trim() + ")");
                    if( json1 .success ){
                        cTool.setVal( "field6482" , json1 .departmentcode.substr(0,2) );
                        cTool.setVal( "field6657" , json1 .supdepid );
                        cTool.setVal( "field6658" , json1 .coadjutant );
                        cTool.setVal( "field6415" , json1 .cbzxsprjs);
                    }else{
                        alert("系统错误，请联系管理员。错误说明：" + json.mess);
                    }

                }
            });
        }

        var cbzxChangeHandle;
        function _cbzxChange(){
            if( cbzxChangeHandle ){
                clearTimeout( cbzxChangeHandle );
            }
            cbzxChangeHandle  = setTimeout( cbzxChange , 100 );
        }

        function findValidationId(val) {///base/findInvoiceTypById.jsp?fieldVal=3
            var msg = "";
            $.ajax({
                type:"GET",
                url:"/aes/getAss.jsp?",
                data: {'val':val,'timeStamp':new Date().getTime()},
                dataType:"text",
                async:false,
                success:function(data){
                    var str=JSON.stringify(data);
                    msg=str.substring(str.indexOf("body>")+29,str.indexOf("</body")-8);
                    console.log("msg::"+msg);
                    console.log("\"true\"==msg"+("true"==msg));
                    if("true"==msg){
                        console.log("setFlag");
                        alertFlag="true";
                        console.log("alertFlag::"+alertFlag);
                    }
                },
                error:function(jqXHR){
                    alert("发生错误："+ jqXHR.status);
                }
            });
        }

        //表单提交校验函数
        checkCustomize = function(){
            console.log("checkCustomize::")

            showInfo();

            alertFlag="false"
            var bxJe_field="#field6039"//报销金额
            var hzJe_field="#field9136";//发票汇总金额
            var purchaser_field="#field9146"//销售方名称
            var bxje=$(bxJe_field).val();
            var hzje=$(hzJe_field).val();
            console.log("bxje::"+bxje)
            console.log("hzje::"+hzje)
            if(Number(bxje)>Number(hzje)){
                alert("报销总金额不能大于发票汇总金额！！！")
                return false;
            }

            var num = $("#submitdtlid1").val();
            num = num.split(",")
            for (var i = 0; i < num.length; i++) {
                var val = $(purchaser_field+"_"+num[i]).val();
                console.log("$(purchaser_field+\"_\"+num[i])::"+purchaser_field+"_"+num[i])
                console.log("val::"+val)
                findValidationId(val);
            }
            console.log("alertFlag::"+alertFlag)
            if("true"==alertFlag){
                alert("识别关联企业发票");
            }

            var requestidtemp3 = "0";
            //if(jQuery("#requestid").length){
            //存在
            requestidtemp3 = jQuery("#requestid").val();
            //}
            var prerequestidtemp3 ="0";


            if(jQuery("#field6036").val()!=""){

                prerequestidtemp3 = jQuery("#field6036").val();
            }


            var checkval3 = checkpreworkflow3(prerequestidtemp3);
            if((checkval3!="nodeerror2")&&(prerequestidtemp3!="0")&&(checkval3!="nodeerror1")&&(checkval3!="notfit")){

                alert("事前申请流程应该在归档节点!");
                return false;
            }
            var checkval4 = checkpreworkflow4(prerequestidtemp3,requestidtemp3);


            var _xm_array111 = jQuery("select[name^='field6418']");
            if(_xm_array111.length<=0){
                alert("必须填写一条明细");
                return false;
            }
            //成本中心赋值到明细
            //if(!candetail) jQuery( '[name^=' + objcbzxdt + ']' ).val(jQuery('#' + objcbzx).val());
            if(checkOldRequest(jQuery("#field6036").val())){
                return true;

            }


            var lclx = getVal( 'field6479' ),spbz=getVal('field6480');
            if(lclx == 41){
                if(spbz!=1){
                    alert('事前申请流程未审批结束！');
                    return false;
                }
            }
            var flag = true;
            if(detailneedflag){
                flag = _detailneed( 0 );
            };
            if( flag ) initLocal();
            //if (!checkJe()) return;

            var all1 = jQuery("#submitdtlid0").val();

            var allArray = all1.split(',');
            for(var i = 0;i<allArray.length;i++){
                var index = allArray[i];
                var ksje = jQuery("#field6418_"+index).val(); //项目
                var sfz = jQuery.trim(jQuery("#field9017_"+index).val());//业务流程
                if(ksje != '' && ksje != null && ksje != undefined){
                    if(ksje ==53 && sfz == ''){//项目为业务招待费，业务流程为空
                        alert('项目为业务招待费时，业务流程必须填写');
                        return false;
                    }
                }
            }




            //预提预算：如果申请金额大于事前申请金额，false 如果预算所属年、成本中心、项目跟事前申请流程对应，false
            //事前申请流程=6036  项目=6418  预算所属年=7005 申请部门(成本中心) 明细成本中心=6474 项目大类=7003
            if(jQuery("#field7003").val()=="0" || jQuery("#field7003").val()=="1" || jQuery("#field7003").val()=="2" || jQuery("#field7003").val()=="12"){
                if(jQuery("#field6036").val()==""){
                    alert("\"事前申请流程\"未填写!");
                    return false;
                }
                //申请支付金额=6039   事前申请金额=6037
                //if(parseFloat(jQuery("#field6039").val())>parseFloat(jQuery("#field6037").val())){
                //alert("申请金额大于事前申请金额!");
                //return false;
                //}

                var requestidtemp = jQuery("#field6036").val();
                var fnayeartemp = jQuery("#field7005").val();
                var fnadepttemp = "";
                var projectidtemp = "";
                var numstemp = document.getElementById("indexnum0").value * 1.0 - 1;
                var tempamount = 0;
                var details = 0;
                var requestidtemp2 = "0";
                if(jQuery("#requestid").length){
                    //存在
                    requestidtemp2 = jQuery("#requestid").val();
                }
                //for(var i=0;i<=numstemp;i++){
                var _xm_array = jQuery("select[name^='field6418_']");
                var i=0;

                console.log("_xm_array::"+_xm_array)

                for(var i0=0;i0<_xm_array.length;i0++){
                    i = parseInt(jQuery(_xm_array[i0]).attr("name").replace("field6418_",""));
                    if(jQuery("#field6418_"+i).length){
                        projectidtemp = jQuery("#field6418_"+i).val();
                        fnadepttemp = jQuery("#field6474_"+i).val();
                        if(projectidtemp!=33 && projectidtemp!=31 &&
                            projectidtemp!=1 && projectidtemp!=2 && projectidtemp!=3 && projectidtemp!=4 && projectidtemp!=5 &&
                            projectidtemp!=6 && projectidtemp!=7 && projectidtemp!=8 && projectidtemp!=50 && projectidtemp!=51 &&
                            projectidtemp!=52 && projectidtemp!=53 && projectidtemp!=54 ){
                            alert("明细中存在不需要事前申请的费用项目！");
                            return false;
                        }

                        //tagtag
                        var prerequestidtemp2 = jQuery("#field6036").val();
                        var fnayeartemp2 = jQuery("#field7005").val();
                        var fnadepttemp2 = jQuery("#field6474_"+i).val();
                        var projectidtemp2 = jQuery("#field6418_"+i).val();
                        var feetemp2 = jQuery("#field6035_"+i).val();
                        feetemp2= getJe_fee_judge_fywbm(i);
                        var checkval2 = checkpreworkflow2(prerequestidtemp2,requestidtemp2,fnayeartemp2,fnadepttemp2,projectidtemp2,feetemp2);
                        //var tempcheckval = checkworkflow(requestidtemp,fnayeartemp,fnadepttemp,projectidtemp);

                        console.log("checkval2::"+checkval2)
                        if(checkval2=="nodeerror"){
                            alert("第"+(i0+1)+"行明细,事前申请流程应该在会计做账节点!");
                            return false;
                        }else if(checkval2=="nofit"){
                            alert("第"+(i0+1)+"行明细,预算所属年、成本中心、项目跟事前申请流程应该对应!");
                            return false;
                        }else if(checkval2=="over"){
                            alert("第"+(i0+1)+"行明细,申请金额大于可用事前申请金额!");
                            return false;
                        }

                        //details=details+1;
                    }
                }
                if(details!=1){
                    //alert("有且只能有一条明细数据！");
                    //return false;
                }


            }else if(jQuery("#field7003").val()=="7" && jQuery("#field7004").val()=="2"){
                var numstemp = document.getElementById("indexnum0").value * 1.0 - 1;
                var requestidtemp2 = "0";
                if(jQuery("#requestid").length){
                    //存在
                    requestidtemp2 = jQuery("#requestid").val();
                }
                //for(var i=0;i<=numstemp;i++){
                var _xm_array = jQuery("select[name^='field6418_']");
                var i=0;
                for(var i0=0;i0<_xm_array.length;i0++){
                    i = parseInt(jQuery(_xm_array[i0]).attr("name").replace("field6418_",""));
                    if(jQuery("#field6418_"+i).length ){
                        var prerequestidtemp2 = jQuery("#field6036").val();
                        var fnayeartemp2 = jQuery("#field7005").val();
                        var fnadepttemp2 = jQuery("#field6474_"+i).val();
                        var projectidtemp2 = jQuery("#field6418_"+i).val();
                        var feetemp2 = jQuery("#field6035_"+i).val();
                        feetemp2= getJe_fee_judge_fywbm(i);
                        var checkval2 = checkpreworkflow2(prerequestidtemp2,requestidtemp2,fnayeartemp2,fnadepttemp2,projectidtemp2,feetemp2);
                        if(checkval2=="nodeerror"){
                            alert("第"+(i0+1)+"行明细,事前申请流程应该在会计做账节点!");
                            return false;
                        }else if(checkval2=="nofit"){
                            alert("第"+(i0+1)+"行明细,预算所属年、成本中心、项目跟事前申请流程应该对应!");
                            return false;
                        }else if(checkval2=="over"){
                            alert("第"+(i0+1)+"行明细,申请金额大于可用事前申请金额!");
                            return false;
                        }
                    }
                }


            }else{//如果金额大于可用预算额不能提交

                for(var ii=0;ii<2;ii++){
                    var checktemp = checkIfOver();
                    //alert("调试信息：ii="+ii+";;;checktemp="+checktemp);
                    var _checkIfOver_error_info_rownumberinfo = "";
                    try{
                        if(_checkIfOver_error_info_rownumber!=null&&_checkIfOver_error_info_rownumber!=""){
                            _checkIfOver_error_info_rownumberinfo = "第"+_checkIfOver_error_info_rownumber+"行所属部门：";
                        }
                    }catch(ex1){}
                    if(checktemp=="1"){
                        alert(_checkIfOver_error_info_rownumberinfo+"业务招待费与其他费用合计总额已超标");
                        if(ii==1){
                            return false;
                        }
                    }else if(checktemp=="2"){
                        if(ii<1){
                            alert(_checkIfOver_error_info_rownumberinfo+"业务招待费预算已超额，请注意！");
                        }
                        if(ii==1){
                            return true;
                        }
                    }else if(checktemp=="3"){
                        alert(_checkIfOver_error_info_rownumberinfo+"业务招待费与其他费用合计总额已超标");
                        if(ii==1){
                            return false;
                        }
                    }else if(checktemp=="4"){
                        alert(_checkIfOver_error_info_rownumberinfo+"项目申请金额大于可用预算额!");
                        if(ii==1){
                            return false;
                        }
                    }
                }

            }
            return flag;
        }

        function _pageinit(){
            Fns.initNo();

            initCreateRole();
            if(cTool.isCreate()) _cbzxChange();
            // jQuery( "#" + objcbzx ).bind( 'propertychange' , _cbzxChange );

            jQuery( "#" + objcbzx ).bindPropertyChange( _cbzxChange );
            //jQuery( 'select[name^=field6418]' ).bind( 'change' , xmchange );
            //xmchange();
            // jQuery('#field6677').attr('readonly','true').css( 'border-bottom','none' );
            //jQuery( '#' + objbxje ).bind('propertychange',bxjechange);
            jQuery( '#' + objbxje ).bindPropertyChange(bxjechange);
            jQuery( '#' + objfjzs ).css('text-align','center').blur();
            initDetail( 0 , true );
            jQuery( '#' + objbxjedx ).css( 'border-bottom','none' ).attr( 'readOnly' , 'true' );
            jQuery( '#' + objbxje ).css( 'border-bottom','none' ).attr( 'readOnly' , 'true' );
        }
        setTimeout(_pageinit,100);

    })

    function checkOldRequest(requestid){
        var returnval=false;
        jQuery.ajax({
            url : "/workflow/request/CheckIfOldRequest.jsp",
            type : "post",
            async : false,
            processData : false,
            data : "requestid="+requestid,
            dataType : "json",
            success: function do4Success(msg){
                var infos = msg;
                returnval=infos;
            }
        });
        return returnval;
    }
    function showInfo() {
        console.log("file showInfo::")
        /*//明细
       var jshjField="#field9140";//价税合计字段
       var invoiceTypeField="#field9152"//费用类型
       var territoryField="#field9155";//境外出差
       var timeField="#field9153";//时间段
       var mobileField="#field9156";//手机号
       var zymcField="#field9147";//摘要名称

       var producerField="#field9158"//监制章
       var sfyzField="#field9160"//是否有章
       //主表
       var bxr="#field6557";//报销人
       var ccrq="#field6009"//出差日期
       var fhrq="#field6010";//返回日期
       var ewsm="#field6691"//07
       var shiyou="#field6677"//07*/
        var fields="#field9140,#field9152,#field9155,#field9153,#field9156,#field9147,#field9158,#field9160";//顺序参照为上述注释明细从上到下 6  7 9配置全部明细， 4 10 11只配监制章 是否有章
        var mainFields="#field6691,#field6677";//顺序参照为上述注释主表从上到下  但是07 只配置ewsm，shiyou ，06，09 只配置bxr，ccrq，fhrq  其他流程不配置
        var errField="#field9534";//失败原因
        var index=7;// 示列： 06 就配置 6
        console.log("fields::"+fields)
        console.log("mainFields::"+mainFields)
        console.log("index::"+index)

        var num = $("#submitdtlid1").val();
        num = num.split(",")
        var jsonArr = new Array();
        var fieldArr = fields.split(",")
        var mainArr = mainFields.split(",")
        for (var i = 0; i < num.length; i++) {//jshj,invoiceType zymc  //bxr  ccrq   fhrq   //territory//time  fksy   ccsy  ewsm  shiyou//mobile
            var count=0;
            var imap={}
            if("9"==index||"6"==index||"7"==index){
                /*console.log("fieldArr[count++]+\"_\"+num[i]  jshj::"+(fieldArr[0]+"_"+num[i]))
                                   console.log("fieldArr[count++]+\"_\"+num[i]  zymc::"+(fieldArr[5]+"_"+num[i]))*/
                imap.jshj=$(fieldArr[count++]+"_"+num[i]).val()
                imap.invoiceType=$(fieldArr[count++]+"_"+num[i]).val()
                imap.territory=$(fieldArr[count++]+"_"+num[i]).val()
                imap.time=$(fieldArr[count++]+"_"+num[i]).val()
                imap.mobile=$(fieldArr[count++]+"_"+num[i]).val()
                imap.zymc=$(fieldArr[count++]+"_"+num[i]).val()
                imap.producer=$(fieldArr[count++]+"_"+num[i]).val()
                imap.sfyz=$(fieldArr[count++]+"_"+num[i]).val()
                console.log("imap::"+imap);
                jsonArr[i]=imap;
            }else{
                imap.producer=$(fieldArr[0]+"_"+num[i]).val()
                imap.sfyz=$(fieldArr[1]+"_"+num[i]).val()
                jsonArr[i]=imap;
            }
        }
        var mainMap={}
        if("9"==index||"6"==index){
            mainMap.bxr=$(mainArr[0]).val();
            mainMap.ccrq=$(mainArr[1]).val();
            mainMap.fhrq=$(mainArr[2]).val();
        }else if("7"==index){
            mainMap.ewsm=$(mainArr[0]).val();
            mainMap.shiyou=$(mainArr[1]).val();
        }
        var jsonMain = "["+JSON.stringify(mainMap)+"]";
        var jsonDetail=JSON.stringify(jsonArr);
        console.log("jsonMain::"+jsonMain);
        console.log("jsonDetail::"+jsonDetail);
        findMsg(jsonMain,jsonDetail,index,errField);
    }

    /**
     * 后台提交查询提示
     * @param val
     */
    function findMsg(jsonMain,jsonDetail,type,errField) {///base/findInvoiceTypById.jsp?fieldVal=3
        var msg = "";
        $.ajax({
            type:"GET",
            url:"/aes/getAlertInfo.jsp?",
            data: {'jsonMain':jsonMain,"jsonDetail":jsonDetail,jsType:type,'timeStamp':new Date().getTime()},
            dataType:"text",
            async: false,
            success:function(data){
                var str=JSON.stringify(data);
                console.log("str::"+str)
                msg=str.substring(str.indexOf("<body>")+18,str.indexOf("</body>")-4);
                console.log("msg::"+msg)
                if(msg.length>4){
                    //$(errField).val(msg)
                    var ms=""
                    var msgArr = msg.split("_")
                    console.log("msgArr::"+msgArr.length)
                    for(var i=0;i<msgArr.length;i++){
                        var msi=msgArr[i];
                        console.log("msi::"+msi)
                        if(msi.indexOf(":")!=-1){
                            var msiArr = msi.split(":");
                            var colIndex = msiArr[0].substring(1,2)
                            var index = $("#oTable1 tbody tr[_target='datarow']").eq(Number(colIndex)-1).attr("_rowindex")
                            console.log("index::"+index)
                            console.log("msiArr[1]"+msiArr[1])
                            $(errField+"_"+index).val(msiArr[1]);
                        }
                        ms=ms+msi+"\n";
                    }
                    console.log("ms::"+ms)
                    alert(ms)
                }
            },
            error:function(jqXHR){
                alert("发生错误："+ jqXHR.status);
            }
        });
    }

</script>